<%- include("./partials/header") %>

<body>
    <div class="parent">
        <div class="Navguide">
            <a href="/"> <h1>Tilbake</h1></a>
            <% if (isloggedin){ %>
                <a href="/dashboard"><h2>Profile</h2></a>
            <% } else { %>
                <a href="/login"><h2>Logg inn</h2></a>
            <% } %>
        </div>
        <div class="background">
            <h1>Guide til Verden</h1>
            <div class="guides-container">
                <div id="guide<%= guide._id %>" class="texton">
                    <h2><%= guide.tittel %></h2>
                    <p><%= guide.beskrivelse %></p>

                    <% if (guide.bilde) { %>
                        <img src="/uploads/<%= guide.bilde %>" alt="Bilde for <%= guide.tittel %>" class="bilder"/>
                    <% } %>

                    <% if (isloggedin) { %>
                        <button class="editButton" data-id="<%= guide._id %>">Rediger</button>
                        <button class="saveButton" data-id="<%= guide._id %>" style="display:none;">Lagre</button>
                        <form action="/guide/<%= guide._id %>/delete" method="POST" onsubmit="return confirm('Er du sikker pÃ¥ at du vil slette denne guiden?');" style="display:inline;">
                            <button type="submit" class="deleteButton">Slett</button>
                        </form>
                    <% } %>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.querySelectorAll(".editButton").forEach(button => {
            button.addEventListener("click", function() {
                const guideId = button.getAttribute("data-id");
                const textDiv = document.querySelector(`#guide${guideId}`);

                const titleElement = textDiv.querySelector("h2");
                const descriptionElement = textDiv.querySelector("p");
                const imgElement = textDiv.querySelector("img");

                if (titleElement && descriptionElement) {
                    const title = titleElement.textContent;
                    const description = descriptionElement.textContent;
                    const imgSrc = imgElement ? imgElement.src : "";

                    textDiv.innerHTML = `
                        <form action="/guide/${guideId}/edit" method="POST" enctype="multipart/form-data">
                            <input type="text" name="tittel" value="${title}" required/>
                            <textarea name="beskrivelse" required>${description}</textarea>
                            
                            <label for="bilde">Velg nytt bilde (valgfritt):</label>
                            <input type="file" name="bilde" accept="image/*"/>
                            
                            <button type="submit">Lagre endringer</button>
                        </form>
                    `;
                } else {
                    console.error("Title or description element not found.");
                }
            });
        });
    </script>
</body>
</html>
